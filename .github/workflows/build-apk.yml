name: ðŸš€ Build Shopath APK

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  # Manual trigger - à¤†à¤ª à¤–à¥à¤¦ à¤­à¥€ build à¤¶à¥à¤°à¥‚ à¤•à¤° à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚
  workflow_dispatch:

jobs:
  build:
    name: Build Debug & Release APK
    runs-on: ubuntu-latest

    steps:
      # Step 1: Code checkout
      - name: ðŸ“¥ Checkout Code
        uses: actions/checkout@v4

      # Step 2: Java 17 setup
      - name: â˜• Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: gradle

      # Step 3: Gradle wrapper executable permission
      - name: ðŸ”§ Make gradlew executable
        run: chmod +x gradlew

      # Step 4: Build Debug APK (à¤¬à¤¿à¤¨à¤¾ signing à¤•à¥‡)
      - name: ðŸ—ï¸ Build Debug APK
        run: ./gradlew assembleDebug --no-daemon

      # Step 5: Debug APK à¤•à¥‹ artifact à¤•à¥‡ à¤°à¥‚à¤ª à¤®à¥‡à¤‚ save à¤•à¤°à¥‡à¤‚
      - name: ðŸ“¦ Upload Debug APK
        uses: actions/upload-artifact@v4
        with:
          name: Shopath-Debug-APK
          path: app/build/outputs/apk/debug/*.apk
          retention-days: 30

      # Step 6: Release APK build (Play Store à¤•à¥‡ à¤²à¤¿à¤ - signing à¤œà¤°à¥‚à¤°à¥€ à¤¹à¥ˆ)
      - name: ðŸ—ï¸ Build Release APK
        run: ./gradlew assembleRelease --no-daemon
        env:
          # à¤¯à¥‡ secrets à¤†à¤ª GitHub à¤ªà¤° add à¤•à¤°à¥‡à¤‚à¤—à¥‡ (Play Store à¤•à¥‡ à¤²à¤¿à¤)
          KEYSTORE_PASSWORD: ${{ secrets.KEYSTORE_PASSWORD }}
          KEY_ALIAS: ${{ secrets.KEY_ALIAS }}
          KEY_PASSWORD: ${{ secrets.KEY_PASSWORD }}
        continue-on-error: true  # à¤…à¤­à¥€ signing à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆ à¤¤à¥‹ error ok à¤¹à¥ˆ

      # Step 7: Upload Release APK (à¤…à¤—à¤° build à¤¹à¥à¤ˆ)
      - name: ðŸ“¦ Upload Release APK
        uses: actions/upload-artifact@v4
        if: success()
        with:
          name: Shopath-Release-APK
          path: app/build/outputs/apk/release/*.apk
          retention-days: 90
        continue-on-error: true

      # Step 8: Build summary
      - name: ðŸ“‹ Build Summary
        run: |
          echo "## âœ… Build Complete!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“± APK Files:" >> $GITHUB_STEP_SUMMARY
          find app/build/outputs/apk -name "*.apk" | while read f; do
            size=$(du -h "$f" | cut -f1)
            echo "- \`$(basename $f)\` - Size: $size" >> $GITHUB_STEP_SUMMARY
          done
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“¥ Download:" >> $GITHUB_STEP_SUMMARY
          echo "Actions tab â†’ à¤‡à¤¸ run à¤ªà¤° click à¤•à¤°à¥‡à¤‚ â†’ Artifacts section à¤®à¥‡à¤‚ APK download à¤•à¤°à¥‡à¤‚" >> $GITHUB_STEP_SUMMARY
