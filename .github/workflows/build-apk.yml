name: ðŸš€ Build Shopath APK

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    name: Build Debug & Release APK
    runs-on: ubuntu-latest

    steps:
      # Step 1: Code checkout
      - name: ðŸ“¥ Checkout Code
        uses: actions/checkout@v4

      # Step 2: Java 17 setup
      - name: â˜• Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      # Step 3: Gradle Wrapper JAR download (binary file à¤œà¥‹ repo à¤®à¥‡à¤‚ à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹à¤¤à¥€)
      - name: ðŸ“¦ Download Gradle Wrapper JAR
        run: |
          mkdir -p gradle/wrapper
          curl -sL -o gradle/wrapper/gradle-wrapper.jar \
            "https://github.com/gradle/gradle/raw/v8.4.0/gradle/wrapper/gradle-wrapper.jar"

      # Step 4: gradlew à¤•à¥‹ executable à¤¬à¤¨à¤¾à¤à¤‚
      - name: ðŸ”§ Make gradlew executable
        run: chmod +x gradlew

      # Step 5: Debug APK build
      - name: ðŸ—ï¸ Build Debug APK
        run: ./gradlew assembleDebug --no-daemon --stacktrace

      # Step 6: Debug APK upload (download à¤•à¥‡ à¤²à¤¿à¤)
      - name: ðŸ“¦ Upload Debug APK
        uses: actions/upload-artifact@v4
        with:
          name: Shopath-Debug-APK
          path: app/build/outputs/apk/debug/*.apk
          retention-days: 30

      # Step 7: Build Summary
      - name: ðŸ“‹ Build Summary
        run: |
          echo "## âœ… Build Complete!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“± APK Files:" >> $GITHUB_STEP_SUMMARY
          find app/build/outputs/apk -name "*.apk" 2>/dev/null | while read f; do
            size=$(du -h "$f" | cut -f1)
            echo "- \`$(basename $f)\` - Size: $size" >> $GITHUB_STEP_SUMMARY
          done
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“¥ APK Download à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤:" >> $GITHUB_STEP_SUMMARY
          echo "Actions tab â†’ à¤‡à¤¸ run à¤ªà¤° click â†’ Artifacts section â†’ **Shopath-Debug-APK**" >> $GITHUB_STEP_SUMMARY
